<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="admin.css"> <link href="https://fonts.googleapis.com/css2?family=Anton&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Estilos m√≠nimos para que el iframe se vea integrado */
        body { background: transparent; padding: 10px; color: white; overflow-y: auto; }
        .menu-zona { display: block !important; margin: auto; max-width: 450px; }
        .btn-accion { width: 100%; margin: 10px 0; cursor: pointer; }
        select { background: #333; color: white; border-radius: 5px; padding: 5px; width: 100%; }
    </style>
</head>
<body>

    <div class="menu-zona">
        <h4 id="dinamico-titulo">Acciones para Zona ...</h4>
        <ul>
            <li>üìù <button onclick="ejecutarCarga()" class="btn-accion">Cargar patinadoras/es</button></li>
            <li>‚úÖ <button onclick="ejecutarAltas(window.zonaActivaNum)" class="btn-accion">Altas pr√≥xima fecha</button></li>
            <li>üëÅÔ∏è <button onclick="ejecutarVerDatos()" class="btn-accion">Ver datos cargados</button></li>
            <li>üè¢ <button onclick="ejecutarModalClubes()" class="btn-accion" style="background: rgba(255,215,0,0.1); border: 1px dashed gold;">Asociar nuevo Club</button></li>
        </ul>
    </div>
<div id="contenedor-formulario-dinamico" style="display: none; margin-top: 20px;">
    </div>

    <div id="ModalClub" style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); padding-top: 100px;">
    <div style="background: #1a1a1a; margin: auto; padding: 20px; border: 1px solid gold; border-radius: 15px; width: 80%; max-width: 400px; text-align: center; color: white;">
        <h3 style="color: gold; font-family: 'Anton', sans-serif;">ASOCIAR NUEVO CLUB</h3>
        <p style="font-size: 0.8rem; margin-bottom: 15px;">Escrib√≠ el nombre del club para solicitar el alta:</p>
        
        <input type="text" id="nuevo-club-nombre" placeholder="NOMBRE DEL CLUB" class="input-registro" style="width: 100%; margin-bottom: 20px; text-transform: uppercase;">
        
        <div style="display: flex; gap: 10px;">
            <button onclick="window.guardarNuevoClub()" style="flex: 1; padding: 10px; background: gold; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">ENVIAR</button> 
            <button onclick="window.cerrarModalClubes()" style="flex: 1; padding: 10px; background: #444; color: white; border: none; border-radius: 5px; cursor: pointer;">CANCELAR</button>
        </div>
    </div>
</div>

<script src="acciones_zonas.js?v=1.1"></script>

 <script>
    // 1. Detecci√≥n de zona (Aseguramos que existan antes de usarlas)
    const urlParams = new URLSearchParams(window.location.search);
    const zonaSaca = urlParams.get('zona'); 
    
    // Las guardamos en window para que el .js las vea
    window.zonaActivaNum = zonaSaca; 
    window.zonaActiva = "ZONA " + zonaSaca; 

    // Seteamos el t√≠tulo
    const titulo = document.getElementById('dinamico-titulo');
    if (titulo) titulo.innerText = `Acciones para Zona ${zonaSaca}`;

    // 2. Funciones Puente
    function ejecutarCarga() {
        // Verificamos que zonaActivaNum tenga algo
        if (!window.zonaActivaNum) {
            console.error("Error: No se detect√≥ el n√∫mero de zona en la URL");
            return;
        }
        
        console.log("Cargando para Zona: " + window.zonaActivaNum);
        
        if (typeof abrirFormularioCarga === 'function') {
            abrirFormularioCarga(window.zonaActivaNum); 
        } else {
            console.error("La funci√≥n abrirFormularioCarga no est√° definida en acciones_zonas.js");
        }
    }

    function ejecutarVerDatos() {
        alert("Visualizando datos de " + window.zonaActiva);
    }


  // Esta funci√≥n le grita al padre lo que tiene que guardar
  async function enviarDatosAlPadre(emailKey, clubKey) {
    if (parent && parent.registrarClubEnFirebase) {
      await parent.registrarClubEnFirebase(emailKey, clubKey);
    } else {
      throw new Error("Conexi√≥n no lista");
    }
  }

function ejecutarModalClubes() {
    if (typeof window.abrirModalClubes === 'function') {
        window.abrirModalClubes();
    } else {
        alert("La funci√≥n de clubes todav√≠a se est√° cargando. Esper√° un momento.");
    }
}
</script>
</body>
</html>